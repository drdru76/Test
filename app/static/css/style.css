:root {
    --brand: #1dbf73;
    --brand-strong: #15965a;
    --brand-soft: #e6f9ef;
    --ink-900: #191a1b;
    --ink-700: #35383d;
    --ink-500: #6a6f77;
    --ink-300: #cfd4da;
    --surface: #ffffff;
    --surface-soft: #f6f7f9;
    --line: #e4e7eb;
    --warning: #f59e0b;
    --info: #0ea5e9;
    --magic: #3d8bfd;
    --shadow-sm: 0 8px 20px rgba(20, 24, 31, 0.06);
    --shadow-md: 0 20px 48px rgba(20, 24, 31, 0.1);
    --radius-sm: 10px;
    --radius-md: 16px;
    --radius-lg: 24px;
}

[data-bs-theme="dark"] {
    --brand: #2ad885;
    --brand-strong: #20b26d;
    --brand-soft: #143025;
    --ink-900: #f7f9fc;
    --ink-700: #d2d9e3;
    --ink-500: #a0abbb;
    --ink-300: #2f3946;
    --surface: #0f1318;
    --surface-soft: #141b24;
    --line: #26303d;
    --shadow-sm: 0 8px 20px rgba(0, 0, 0, 0.35);
    --shadow-md: 0 20px 48px rgba(0, 0, 0, 0.45);
}

* {
    box-sizing: border-box;
}

body {
    background:
        radial-gradient(circle at 0% 0%, rgba(29, 191, 115, 0.12), transparent 35%),
        radial-gradient(circle at 100% 0%, rgba(15, 23, 42, 0.06), transparent 35%),
        var(--surface-soft);
    color: var(--ink-700);
    font-family: 'Manrope', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    -webkit-font-smoothing: antialiased;
    min-height: 100vh;
}

.page-glow {
    position: fixed;
    top: -120px;
    right: -80px;
    width: 340px;
    height: 340px;
    background: radial-gradient(circle, rgba(29, 191, 115, 0.24) 0%, rgba(29, 191, 115, 0) 70%);
    pointer-events: none;
    z-index: 0;
}

h1, h2, h3, h4, h5, h6 {
    color: var(--ink-900);
    font-weight: 800;
    letter-spacing: -0.02em;
}

a {
    color: var(--brand);
}

a:hover {
    color: var(--brand-strong);
}

.navbar {
    background-color: color-mix(in srgb, var(--surface) 92%, transparent) !important;
    backdrop-filter: blur(10px);
    border-color: var(--line) !important;
    z-index: 10;
}

.navbar-brand {
    font-size: 1.25rem;
    color: var(--ink-900);
}

.brand-mark {
    width: 32px;
    height: 32px;
    border-radius: 10px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--brand) 0%, var(--brand-strong) 100%);
    color: #fff;
    font-size: 0.9rem;
    box-shadow: 0 8px 18px rgba(21, 150, 90, 0.28);
}

.nav-link {
    color: var(--ink-500);
    font-weight: 700;
    font-size: 0.93rem;
}

.nav-link:hover,
.navbar-nav .nav-link.active {
    color: var(--ink-900);
}

.app-shell {
    position: relative;
    z-index: 1;
    margin-top: 2rem;
}

.btn {
    border-radius: 999px;
    font-weight: 700;
    letter-spacing: 0.01em;
    padding: 0.62rem 1.2rem;
    transition: all 0.22s ease;
}

.btn-primary {
    background: linear-gradient(135deg, var(--brand) 0%, var(--brand-strong) 100%);
    border: none;
    color: #fff;
    box-shadow: 0 10px 24px rgba(21, 150, 90, 0.26);
}

.btn-primary:hover,
.btn-primary:focus {
    color: #fff;
    transform: translateY(-1px);
    box-shadow: 0 16px 30px rgba(21, 150, 90, 0.3);
}

.btn-outline-primary {
    color: var(--brand-strong);
    border-color: color-mix(in srgb, var(--brand) 50%, var(--line));
    background: #fff;
}

[data-bs-theme="dark"] .btn-outline-primary {
    background: var(--surface);
}

.btn-outline-primary:hover {
    background: var(--brand-soft);
    color: var(--brand-strong);
    border-color: var(--brand);
}

.btn-outline-secondary {
    border-color: var(--line);
    color: var(--ink-500);
}

.btn-outline-secondary:hover {
    border-color: var(--ink-500);
    color: var(--ink-900);
}

.btn-magic {
    background: linear-gradient(135deg, #3d8bfd 0%, #2463eb 100%);
    border: none;
    color: white;
}

.btn-magic:hover {
    background: linear-gradient(135deg, #3076db 0%, #1c51c9 100%);
    color: white;
}

.btn-outline-magic {
    border: 1px solid #3d8bfd;
    color: #2463eb;
}

.btn-outline-magic:hover {
    background: rgba(61, 139, 253, 0.1);
    color: #1c51c9;
}

.card {
    border: 1px solid var(--line);
    border-radius: var(--radius-md);
    background-color: var(--surface);
    box-shadow: var(--shadow-sm);
    transition: transform 0.22s ease, box-shadow 0.22s ease, border-color 0.22s ease;
}

.card:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-md);
    border-color: color-mix(in srgb, var(--brand) 36%, var(--line));
}

.card-header {
    border-bottom: 1px solid var(--line);
    background: color-mix(in srgb, var(--surface-soft) 88%, white);
    font-weight: 700;
}

.badge {
    border-radius: 999px;
    font-weight: 700;
    letter-spacing: 0.01em;
    padding: 0.42rem 0.72rem;
}

.bg-light {
    background-color: var(--surface-soft) !important;
}

.themed-panel {
    background-color: var(--surface-soft) !important;
    border-color: var(--line) !important;
}

.bg-primary-subtle {
    background-color: var(--brand-soft) !important;
}

.text-primary {
    color: var(--brand) !important;
}

.text-muted {
    color: var(--ink-500) !important;
}

.text-dark,
.text-dark-emphasis,
.text-secondary {
    color: var(--ink-900) !important;
}

.alert {
    border-radius: var(--radius-sm);
    border-color: var(--line);
    box-shadow: var(--shadow-sm);
}

.alert-warning {
    border-color: rgba(245, 158, 11, 0.36);
    background: rgba(245, 158, 11, 0.1);
}

.alert-info {
    border-color: rgba(14, 165, 233, 0.36);
    background: rgba(14, 165, 233, 0.1);
}

.form-control,
.form-select {
    background: var(--surface);
    border: 1px solid var(--line);
    border-radius: var(--radius-sm);
    color: var(--ink-900);
    padding: 0.75rem 0.95rem;
}

.form-control:focus,
.form-select:focus {
    border-color: color-mix(in srgb, var(--brand) 70%, white);
    box-shadow: 0 0 0 0.2rem rgba(29, 191, 115, 0.15);
}

.form-label {
    font-weight: 700;
    color: var(--ink-700);
}

.breadcrumb-item a {
    color: var(--brand-strong);
    text-decoration: none;
    font-weight: 700;
}

.breadcrumb-item.active {
    color: var(--ink-500);
}

.decision-header-card {
    border: 1px solid var(--line);
    border-radius: var(--radius-lg);
    background:
        linear-gradient(180deg, color-mix(in srgb, var(--surface-soft) 68%, white) 0%, var(--surface) 100%);
    box-shadow: var(--shadow-sm);
}

.accordion-item {
    border: 1px solid var(--line) !important;
    border-radius: var(--radius-md) !important;
    overflow: hidden;
    box-shadow: var(--shadow-sm);
}

.accordion-button {
    font-weight: 700;
    background-color: var(--surface);
    color: var(--ink-900);
}

.accordion-button:not(.collapsed) {
    background-color: var(--surface-soft);
    color: var(--ink-900);
    box-shadow: none;
}

.accordion-button:focus {
    box-shadow: none;
    border-color: transparent;
}

.accordion-body {
    background-color: var(--surface);
}

.stage-guidance {
    background-color: color-mix(in srgb, var(--brand-soft) 65%, white) !important;
    border-left: 4px solid var(--brand) !important;
}

.border-magic {
    border-color: rgba(61, 139, 253, 0.35) !important;
}

.bg-magic {
    background: linear-gradient(135deg, #3d8bfd 0%, #2463eb 100%) !important;
}

.bg-magic-subtle {
    background-color: rgba(61, 139, 253, 0.08);
}

.text-magic {
    color: #2463eb !important;
}

.text-gradient {
    color: var(--brand) !important;
}

.hover-shadow:hover {
    box-shadow: var(--shadow-sm);
}

.footer {
    margin-top: 4rem;
    padding: 2rem 0;
    border-top: 1px solid var(--line);
    color: var(--ink-500);
}

.border-dashed {
    border-style: dashed !important;
}

.view-toggle-group {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
}

.view-toggle-btn {
    min-width: 72px;
}

.view-toggle-btn.active {
    background: var(--ink-900);
    border-color: var(--ink-900);
    color: #fff;
}

.decision-grid-toolbar {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
}

.decision-grid-toolbar .form-control,
.decision-grid-toolbar .form-select {
    max-width: 320px;
}

.decision-aggrid {
    width: 100%;
    height: clamp(420px, 62vh, 760px);
    border: 1px solid var(--line);
    border-radius: var(--radius-sm);
    overflow: hidden;
    box-shadow: var(--shadow-sm);
}

.ag-theme-quartz {
    --ag-background-color: var(--surface);
    --ag-foreground-color: var(--ink-700);
    --ag-header-background-color: var(--surface-soft);
    --ag-header-foreground-color: var(--ink-900);
    --ag-border-color: var(--line);
    --ag-row-hover-color: color-mix(in srgb, var(--brand-soft) 45%, var(--surface));
    --ag-odd-row-background-color: color-mix(in srgb, var(--surface-soft) 55%, var(--surface));
    --ag-selected-row-background-color: color-mix(in srgb, var(--brand-soft) 70%, var(--surface));
    --ag-input-focus-border-color: var(--brand);
    --ag-modal-overlay-background-color: rgba(15, 19, 24, 0.35);
    --ag-font-family: 'Manrope', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    --ag-font-size: 13px;
}

[data-bs-theme="dark"] .ag-theme-quartz {
    --ag-background-color: #111821;
    --ag-foreground-color: #d6dfeb;
    --ag-header-background-color: #1a2431;
    --ag-header-foreground-color: #f3f7ff;
    --ag-border-color: #2a3747;
    --ag-secondary-border-color: #334255;
    --ag-row-hover-color: rgba(42, 216, 133, 0.12);
    --ag-odd-row-background-color: #131d28;
    --ag-selected-row-background-color: rgba(42, 216, 133, 0.16);
    --ag-input-focus-border-color: #2ad885;
    --ag-modal-overlay-background-color: rgba(5, 8, 12, 0.6);
}

[data-bs-theme="dark"] .decision-grid-toolbar .form-control,
[data-bs-theme="dark"] .decision-grid-toolbar .form-select {
    background: #111821;
    border-color: #334255;
    color: #e6edf8;
}

[data-bs-theme="dark"] .decision-grid-toolbar .form-control::placeholder {
    color: #8ea0b7;
}

[data-bs-theme="dark"] .decision-header-card {
    background: linear-gradient(180deg, #1a2431 0%, #111821 100%);
    border-color: #334255;
}

[data-bs-theme="dark"] .themed-panel {
    background-color: #17212d !important;
    border-color: #334255 !important;
}

[data-bs-theme="dark"] .card.border-warning {
    border-color: rgba(245, 158, 11, 0.42) !important;
}

[data-bs-theme="dark"] .card.border-info {
    border-color: rgba(14, 165, 233, 0.42) !important;
}

.ag-row-link {
    color: var(--brand-strong);
    font-weight: 700;
    text-decoration: none;
}

.ag-row-link:hover {
    text-decoration: underline;
}

.ag-group-row {
    font-weight: 800;
    color: var(--ink-900);
}

.ag-group-toggle {
    display: inline-block;
    width: 14px;
    margin-right: 6px;
    color: var(--ink-500);
}

.ag-row-link-child {
    margin-left: 20px;
}

.ag-group-parent-row .ag-cell {
    background: color-mix(in srgb, var(--surface-soft) 86%, white);
    border-bottom-color: var(--line);
    cursor: pointer;
}

[data-bs-theme="dark"] .ag-group-parent-row .ag-cell {
    background: #1a2431;
    border-bottom-color: #334255;
}

.ag-group-child-row .ag-cell {
    background: var(--surface);
}

[data-bs-theme="dark"] .ag-group-child-row .ag-cell {
    background: #111821;
}

.home-grid-view .decision-tile-grid {
    display: none !important;
}

.home-grid-view .decision-grid-panel {
    display: block !important;
}

@media (min-width: 992px) {
    .decision-grid-toolbar {
        justify-content: flex-start;
    }
}

@media (max-width: 575.98px) {
    .decision-grid-toolbar {
        flex-direction: column;
    }

    .decision-grid-toolbar .form-control,
    .decision-grid-toolbar .form-select {
        max-width: none;
    }
}

.ql-toolbar.ql-snow,
.ql-container.ql-snow {
    border-color: var(--line) !important;
}

.ql-container .ql-editor {
    color: var(--ink-700);
    background: var(--surface);
    font-size: 1rem;
    line-height: 1.62;
}

.ql-container .ql-editor.ql-blank::before {
    color: var(--ink-500);
}

.stage-content-view {
    white-space: pre-wrap;
    line-height: 1.62;
    font-size: 1rem;
    padding: 1rem 1.1rem !important;
}

.stage-content-view p,
.stage-content-view ul,
.stage-content-view ol,
.stage-content-view blockquote {
    margin-bottom: 0.8rem;
}

.stage-content-view p:last-child,
.stage-content-view ul:last-child,
.stage-content-view ol:last-child,
.stage-content-view blockquote:last-child {
    margin-bottom: 0;
}

.stage-content-view ul,
.stage-content-view ol {
    padding-left: 1.35rem;
}

.ql-container.ql-snow {
    border-bottom-left-radius: var(--radius-sm);
    border-bottom-right-radius: var(--radius-sm);
}

.ql-toolbar.ql-snow {
    border-top-left-radius: var(--radius-sm);
    border-top-right-radius: var(--radius-sm);
    background: var(--surface-soft);
}

.quill-auto.ql-container {
    height: auto !important;
    min-height: 220px;
}

.quill-auto.ql-container .ql-editor {
    min-height: 220px;
    height: auto;
    overflow-y: hidden;
}

[data-bs-theme="dark"] .ql-toolbar.ql-snow,
[data-bs-theme="dark"] .ql-container.ql-snow {
    border-color: #334255 !important;
}

[data-bs-theme="dark"] .ql-toolbar.ql-snow {
    background: #17212d;
}

[data-bs-theme="dark"] .ql-container .ql-editor {
    background: #111821;
    color: #d6dfeb;
}

[data-bs-theme="dark"] .ql-snow .ql-stroke {
    stroke: #9db0c8;
}

[data-bs-theme="dark"] .ql-snow .ql-fill {
    fill: #9db0c8;
}

[data-bs-theme="dark"] .ql-snow .ql-picker {
    color: #9db0c8;
}

[data-bs-theme="dark"] .ql-snow .ql-picker-options {
    background: #17212d;
    border-color: #334255;
}

[data-bs-theme="dark"] .stage-display,
[data-bs-theme="dark"] .stage-suggestions-contextual,
[data-bs-theme="dark"] .ai-comparison {
    color: #d6dfeb;
}

@media (max-width: 991.98px) {
    .app-shell {
        margin-top: 1.2rem;
    }

    .navbar {
        backdrop-filter: none;
    }
}

@media (max-width: 575.98px) {
    .btn {
        padding: 0.58rem 1rem;
    }

    .decision-header-card {
        border-radius: var(--radius-md);
    }

    .page-glow {
        width: 220px;
        height: 220px;
        top: -80px;
        right: -60px;
    }
}
